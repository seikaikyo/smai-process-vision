<!DOCTYPE html>
<html lang="zh-TW" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMAI Process Vision - 製程影片分析系統</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.10.2/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        [v-cloak] { display: none; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(4px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .upload-zone {
            border: 2px dashed #ccc;
            transition: all 0.3s;
        }
        .upload-zone:hover, .upload-zone.drag-over {
            border-color: #1E88E5;
            background-color: rgba(30, 136, 229, 0.05);
        }
        .video-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .video-card { transition: all 0.2s; }
    </style>
</head>
<body class="bg-base-200 font-sans text-base-content overflow-hidden">
    <div id="app" v-cloak class="flex h-screen">

        <!-- Sidebar -->
        <aside class="w-64 bg-base-100 border-r border-base-300 flex flex-col shrink-0">
            <div class="p-5 text-xl font-bold text-primary flex items-center border-b border-base-200">
                <i data-lucide="scan-eye" class="mr-2 w-6 h-6"></i>
                Process Vision
            </div>

            <div class="flex-1 overflow-y-auto p-4">
                <div class="text-xs uppercase font-semibold text-base-content/50 mb-2 px-4">總覽</div>
                <ul class="menu menu-md w-full p-0 mb-4">
                    <li><a :class="{ active: currentView === 'dashboard' }" @click="currentView = 'dashboard'">
                        <i data-lucide="gauge" class="w-4 h-4"></i> 儀表板
                    </a></li>
                </ul>

                <div class="text-xs uppercase font-semibold text-base-content/50 mb-2 px-4">影片分析</div>
                <ul class="menu menu-md w-full p-0 mb-4">
                    <li><a :class="{ active: currentView === 'videos' }" @click="currentView = 'videos'">
                        <i data-lucide="video" class="w-4 h-4"></i> 影片管理
                    </a></li>
                    <li><a :class="{ active: currentView === 'analysis' }" @click="currentView = 'analysis'">
                        <i data-lucide="scan" class="w-4 h-4"></i> AOI 分析
                    </a></li>
                    <li><a :class="{ active: currentView === 'comparison' }" @click="currentView = 'comparison'">
                        <i data-lucide="git-compare" class="w-4 h-4"></i> 製程比對
                    </a></li>
                </ul>

                <div class="text-xs uppercase font-semibold text-base-content/50 mb-2 px-4">問題解決</div>
                <ul class="menu menu-md w-full p-0 mb-4">
                    <li><a :class="{ active: currentView === 'reports' }" @click="currentView = 'reports'">
                        <i data-lucide="file-text" class="w-4 h-4"></i> 8D 報告
                    </a></li>
                    <li><a :class="{ active: currentView === 'annotation' }" @click="currentView = 'annotation'">
                        <i data-lucide="highlighter" class="w-4 h-4"></i> 標註工具
                    </a></li>
                </ul>

                <div class="text-xs uppercase font-semibold text-base-content/50 mb-2 px-4">系統</div>
                <ul class="menu menu-md w-full p-0">
                    <li><a :class="{ active: currentView === 'settings' }" @click="currentView = 'settings'">
                        <i data-lucide="settings" class="w-4 h-4"></i> 設定
                    </a></li>
                </ul>
            </div>

            <div class="p-4 border-t border-base-200 bg-base-100/50">
                <div class="flex items-center gap-3">
                    <div class="avatar placeholder">
                        <div class="bg-primary text-primary-content rounded-full w-10">
                            <span>PV</span>
                        </div>
                    </div>
                    <div class="text-sm">
                        <div class="font-bold">Process Vision</div>
                        <div class="text-xs opacity-60">v1.0.0</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto p-8">

            <!-- Dashboard -->
            <section v-if="currentView === 'dashboard'" class="animate-fade-in">
                <header class="flex justify-between items-center mb-6">
                    <div>
                        <div class="text-sm breadcrumbs p-0 mb-1">
                            <ul><li><a>首頁</a></li><li>儀表板</li></ul>
                        </div>
                        <h1 class="text-2xl font-bold flex items-center gap-2">製程分析總覽</h1>
                    </div>
                    <button class="btn btn-primary btn-sm" @click="refreshDashboard">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i> 重新整理
                    </button>
                </header>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="card bg-base-100 shadow-sm border border-base-300">
                        <div class="card-body p-5">
                            <span class="text-sm opacity-60">影片總數</span>
                            <div class="text-3xl font-bold text-primary">{{ stats.videoCount }}</div>
                            <div class="text-xs text-success mt-1">已上傳</div>
                        </div>
                    </div>
                    <div class="card bg-base-100 shadow-sm border border-base-300">
                        <div class="card-body p-5">
                            <span class="text-sm opacity-60">分析完成</span>
                            <div class="text-3xl font-bold text-success">{{ stats.analyzedCount }}</div>
                            <div class="text-xs opacity-60 mt-1">AOI 偵測完成</div>
                        </div>
                    </div>
                    <div class="card bg-base-100 shadow-sm border border-base-300">
                        <div class="card-body p-5">
                            <span class="text-sm opacity-60">8D 報告</span>
                            <div class="text-3xl font-bold">{{ stats.reportCount }}</div>
                            <div class="text-xs opacity-60 mt-1">問題追蹤中</div>
                        </div>
                    </div>
                    <div class="card bg-base-100 shadow-sm border border-base-300">
                        <div class="card-body p-5">
                            <span class="text-sm opacity-60">平均週期時間</span>
                            <div class="text-3xl font-bold text-warning">{{ stats.avgCycleTime }}s</div>
                            <div class="badge badge-success gap-1 mt-2 text-xs" v-if="stats.cycleImprovement > 0">
                                改善 {{ stats.cycleImprovement }}%
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Workflow Guide -->
                <div class="card bg-base-100 shadow-sm border border-base-300 mb-6">
                    <div class="card-body">
                        <h2 class="card-title text-sm font-bold mb-4">製程改善工作流程</h2>
                        <div class="grid grid-cols-4 gap-4">
                            <div class="text-center p-4 bg-primary/10 rounded-lg">
                                <div class="text-2xl font-bold text-primary mb-2">1</div>
                                <div class="font-semibold">影片上傳</div>
                                <div class="text-xs opacity-60 mt-1">上傳製程影片</div>
                            </div>
                            <div class="text-center p-4 bg-secondary/10 rounded-lg">
                                <div class="text-2xl font-bold text-secondary mb-2">2</div>
                                <div class="font-semibold">AOI 分析</div>
                                <div class="text-xs opacity-60 mt-1">YOLO 物件偵測</div>
                            </div>
                            <div class="text-center p-4 bg-accent/10 rounded-lg">
                                <div class="text-2xl font-bold text-accent mb-2">3</div>
                                <div class="font-semibold">製程拆解</div>
                                <div class="text-xs opacity-60 mt-1">分段時間分析</div>
                            </div>
                            <div class="text-center p-4 bg-success/10 rounded-lg">
                                <div class="text-2xl font-bold text-success mb-2">4</div>
                                <div class="font-semibold">8D 改善</div>
                                <div class="text-xs opacity-60 mt-1">問題根因對策</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card bg-base-100 shadow-sm border border-base-300">
                    <div class="card-body">
                        <h2 class="card-title text-sm font-bold">最近活動</h2>
                        <div class="overflow-x-auto">
                            <table class="table table-zebra">
                                <thead>
                                    <tr>
                                        <th>時間</th>
                                        <th>類型</th>
                                        <th>內容</th>
                                        <th>狀態</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="activity in recentActivities" :key="activity.id">
                                        <td class="text-xs opacity-60">{{ activity.time }}</td>
                                        <td><span class="badge badge-sm" :class="activity.typeBadge">{{ activity.type }}</span></td>
                                        <td>{{ activity.content }}</td>
                                        <td><span class="badge badge-sm" :class="activity.statusBadge">{{ activity.status }}</span></td>
                                    </tr>
                                    <tr v-if="recentActivities.length === 0">
                                        <td colspan="4" class="text-center opacity-60">暫無活動記錄</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Videos Management -->
            <section v-if="currentView === 'videos'" class="animate-fade-in">
                <header class="flex justify-between items-center mb-6">
                    <div>
                        <div class="text-sm breadcrumbs p-0 mb-1">
                            <ul><li><a>影片分析</a></li><li>影片管理</li></ul>
                        </div>
                        <h1 class="text-2xl font-bold">影片管理</h1>
                    </div>
                </header>

                <!-- Upload Zone -->
                <div class="card bg-base-100 shadow-sm border border-base-300 mb-6">
                    <div class="card-body">
                        <div class="upload-zone rounded-lg p-8 text-center cursor-pointer"
                             @dragover.prevent="dragOver = true"
                             @dragleave="dragOver = false"
                             @drop.prevent="handleDrop"
                             @click="$refs.fileInput.click()"
                             :class="{ 'drag-over': dragOver }">
                            <input type="file" ref="fileInput" @change="handleFileSelect" accept="video/*" multiple class="hidden">
                            <i data-lucide="upload-cloud" class="w-12 h-12 mx-auto mb-4 opacity-40"></i>
                            <p class="font-semibold">拖放影片檔案至此處</p>
                            <p class="text-sm opacity-60 mt-1">或點擊選擇檔案 (支援 MP4, AVI, MOV)</p>
                        </div>
                    </div>
                </div>

                <!-- Video List -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div v-for="video in videos" :key="video.id" class="card bg-base-100 shadow-sm border border-base-300 video-card">
                        <figure class="relative">
                            <div class="w-full h-40 bg-base-300 flex items-center justify-center">
                                <i data-lucide="film" class="w-12 h-12 opacity-40"></i>
                            </div>
                            <div class="absolute top-2 right-2">
                                <span class="badge" :class="video.statusBadge">{{ video.status }}</span>
                            </div>
                        </figure>
                        <div class="card-body p-4">
                            <h3 class="font-semibold truncate">{{ video.name }}</h3>
                            <div class="text-xs opacity-60">{{ video.duration }} | {{ video.size }}</div>
                            <div class="card-actions justify-end mt-2">
                                <button class="btn btn-ghost btn-xs" @click="viewVideo(video)">
                                    <i data-lucide="play" class="w-3 h-3"></i> 播放
                                </button>
                                <button class="btn btn-primary btn-xs" @click="analyzeVideo(video)" :disabled="video.status === '分析中'">
                                    <i data-lucide="scan" class="w-3 h-3"></i> 分析
                                </button>
                            </div>
                        </div>
                    </div>
                    <div v-if="videos.length === 0" class="col-span-3 text-center py-12 opacity-60">
                        <i data-lucide="video-off" class="w-12 h-12 mx-auto mb-4"></i>
                        <p>尚無影片，請上傳製程影片開始分析</p>
                    </div>
                </div>
            </section>

            <!-- AOI Analysis -->
            <section v-if="currentView === 'analysis'" class="animate-fade-in">
                <header class="flex justify-between items-center mb-6">
                    <div>
                        <div class="text-sm breadcrumbs p-0 mb-1">
                            <ul><li><a>影片分析</a></li><li>AOI 分析</li></ul>
                        </div>
                        <h1 class="text-2xl font-bold">AOI 物件偵測分析</h1>
                    </div>
                </header>

                <div class="alert alert-info shadow-sm mb-6 bg-info/10 border-info/20">
                    <i data-lucide="info" class="w-5 h-5"></i>
                    <span>使用 YOLO11 進行物件偵測，自動識別製程中的人員、設備、物料等</span>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Video Preview -->
                    <div class="card bg-base-100 shadow-sm border border-base-300">
                        <div class="card-body">
                            <h2 class="card-title text-sm font-bold">影片預覽</h2>
                            <div class="aspect-video bg-base-300 rounded-lg flex items-center justify-center">
                                <div v-if="!selectedAnalysisVideo" class="text-center opacity-60">
                                    <i data-lucide="video" class="w-12 h-12 mx-auto mb-2"></i>
                                    <p>請選擇要分析的影片</p>
                                </div>
                                <video v-else :src="selectedAnalysisVideo.url" controls class="w-full h-full rounded-lg"></video>
                            </div>
                            <select class="select select-bordered w-full mt-4" v-model="selectedAnalysisVideoId" @change="selectAnalysisVideo">
                                <option value="">-- 選擇影片 --</option>
                                <option v-for="v in videos" :key="v.id" :value="v.id">{{ v.name }}</option>
                            </select>
                        </div>
                    </div>

                    <!-- Detection Results -->
                    <div class="card bg-base-100 shadow-sm border border-base-300">
                        <div class="card-body">
                            <h2 class="card-title text-sm font-bold">偵測結果</h2>
                            <div v-if="analysisResults.length === 0" class="text-center py-8 opacity-60">
                                <i data-lucide="search" class="w-12 h-12 mx-auto mb-2"></i>
                                <p>尚無分析結果</p>
                            </div>
                            <div v-else class="space-y-2 max-h-80 overflow-y-auto">
                                <div v-for="result in analysisResults" :key="result.id" class="p-3 bg-base-200 rounded-lg">
                                    <div class="flex justify-between items-center">
                                        <span class="font-semibold">{{ result.label }}</span>
                                        <span class="badge badge-primary">{{ result.confidence }}%</span>
                                    </div>
                                    <div class="text-xs opacity-60 mt-1">Frame {{ result.frame }} | {{ result.timestamp }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Segments Timeline -->
                <div class="card bg-base-100 shadow-sm border border-base-300 mt-6">
                    <div class="card-body">
                        <h2 class="card-title text-sm font-bold">製程分段時間軸</h2>
                        <div class="h-32 bg-base-200 rounded flex items-center justify-center text-base-content/40 italic">
                            [ 製程分段時間軸視覺化區域 ]
                        </div>
                    </div>
                </div>
            </section>

            <!-- Comparison -->
            <section v-if="currentView === 'comparison'" class="animate-fade-in">
                <header class="flex justify-between items-center mb-6">
                    <div>
                        <div class="text-sm breadcrumbs p-0 mb-1">
                            <ul><li><a>影片分析</a></li><li>製程比對</li></ul>
                        </div>
                        <h1 class="text-2xl font-bold">改善前後製程比對</h1>
                    </div>
                </header>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Before -->
                    <div class="card bg-base-100 shadow-sm border border-base-300">
                        <div class="card-body">
                            <h2 class="card-title text-sm font-bold text-error">改善前</h2>
                            <div class="aspect-video bg-base-300 rounded-lg flex items-center justify-center">
                                <i data-lucide="video" class="w-12 h-12 opacity-40"></i>
                            </div>
                            <select class="select select-bordered w-full mt-4">
                                <option value="">-- 選擇改善前影片 --</option>
                                <option v-for="v in videos" :key="v.id" :value="v.id">{{ v.name }}</option>
                            </select>
                            <div class="stats shadow mt-4">
                                <div class="stat">
                                    <div class="stat-title">週期時間</div>
                                    <div class="stat-value text-error">45.2s</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- After -->
                    <div class="card bg-base-100 shadow-sm border border-base-300">
                        <div class="card-body">
                            <h2 class="card-title text-sm font-bold text-success">改善後</h2>
                            <div class="aspect-video bg-base-300 rounded-lg flex items-center justify-center">
                                <i data-lucide="video" class="w-12 h-12 opacity-40"></i>
                            </div>
                            <select class="select select-bordered w-full mt-4">
                                <option value="">-- 選擇改善後影片 --</option>
                                <option v-for="v in videos" :key="v.id" :value="v.id">{{ v.name }}</option>
                            </select>
                            <div class="stats shadow mt-4">
                                <div class="stat">
                                    <div class="stat-title">週期時間</div>
                                    <div class="stat-value text-success">32.1s</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Improvement Summary -->
                <div class="card bg-base-100 shadow-sm border border-base-300 mt-6">
                    <div class="card-body">
                        <h2 class="card-title text-sm font-bold">改善效果摘要</h2>
                        <div class="grid grid-cols-3 gap-4 mt-4">
                            <div class="text-center p-4 bg-success/10 rounded-lg">
                                <div class="text-3xl font-bold text-success">-29%</div>
                                <div class="text-sm opacity-60">週期時間縮短</div>
                            </div>
                            <div class="text-center p-4 bg-primary/10 rounded-lg">
                                <div class="text-3xl font-bold text-primary">+15%</div>
                                <div class="text-sm opacity-60">產能提升</div>
                            </div>
                            <div class="text-center p-4 bg-warning/10 rounded-lg">
                                <div class="text-3xl font-bold text-warning">3</div>
                                <div class="text-sm opacity-60">消除動作浪費</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 8D Reports -->
            <section v-if="currentView === 'reports'" class="animate-fade-in">
                <header class="flex justify-between items-center mb-6">
                    <div>
                        <div class="text-sm breadcrumbs p-0 mb-1">
                            <ul><li><a>問題解決</a></li><li>8D 報告</li></ul>
                        </div>
                        <h1 class="text-2xl font-bold">8D 問題解決報告</h1>
                    </div>
                    <button class="btn btn-primary btn-sm" @click="showNewReportModal = true">
                        <i data-lucide="plus" class="w-4 h-4"></i> 新增報告
                    </button>
                </header>

                <div class="alert alert-info shadow-sm mb-6 bg-info/10 border-info/20">
                    <i data-lucide="info" class="w-5 h-5"></i>
                    <span>8D (Eight Disciplines) 是一種系統化的問題解決方法，包含 D1-D8 八個步驟</span>
                </div>

                <!-- Reports List -->
                <div class="card bg-base-100 shadow-sm border border-base-300">
                    <div class="overflow-x-auto">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>報告編號</th>
                                    <th>問題標題</th>
                                    <th>建立日期</th>
                                    <th>進度</th>
                                    <th>狀態</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="report in reports" :key="report.id">
                                    <td class="font-mono">{{ report.reportNo }}</td>
                                    <td>{{ report.title }}</td>
                                    <td class="text-xs opacity-60">{{ report.createdAt }}</td>
                                    <td>
                                        <progress class="progress progress-primary w-20" :value="report.progress" max="100"></progress>
                                        <span class="text-xs ml-2">D{{ report.currentStep }}/8</span>
                                    </td>
                                    <td><span class="badge" :class="report.statusBadge">{{ report.status }}</span></td>
                                    <td>
                                        <button class="btn btn-ghost btn-xs" @click="editReport(report)">
                                            <i data-lucide="edit" class="w-3 h-3"></i> 編輯
                                        </button>
                                    </td>
                                </tr>
                                <tr v-if="reports.length === 0">
                                    <td colspan="6" class="text-center opacity-60 py-8">尚無 8D 報告</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 8D Steps Reference -->
                <div class="card bg-base-100 shadow-sm border border-base-300 mt-6">
                    <div class="card-body">
                        <h2 class="card-title text-sm font-bold">8D 步驟說明</h2>
                        <div class="grid grid-cols-4 gap-2 mt-4">
                            <div class="p-3 bg-base-200 rounded text-center">
                                <div class="font-bold text-primary">D1</div>
                                <div class="text-xs">組建團隊</div>
                            </div>
                            <div class="p-3 bg-base-200 rounded text-center">
                                <div class="font-bold text-primary">D2</div>
                                <div class="text-xs">問題描述</div>
                            </div>
                            <div class="p-3 bg-base-200 rounded text-center">
                                <div class="font-bold text-primary">D3</div>
                                <div class="text-xs">暫時對策</div>
                            </div>
                            <div class="p-3 bg-base-200 rounded text-center">
                                <div class="font-bold text-primary">D4</div>
                                <div class="text-xs">根因分析</div>
                            </div>
                            <div class="p-3 bg-base-200 rounded text-center">
                                <div class="font-bold text-primary">D5</div>
                                <div class="text-xs">永久對策</div>
                            </div>
                            <div class="p-3 bg-base-200 rounded text-center">
                                <div class="font-bold text-primary">D6</div>
                                <div class="text-xs">驗證對策</div>
                            </div>
                            <div class="p-3 bg-base-200 rounded text-center">
                                <div class="font-bold text-primary">D7</div>
                                <div class="text-xs">預防再發</div>
                            </div>
                            <div class="p-3 bg-base-200 rounded text-center">
                                <div class="font-bold text-primary">D8</div>
                                <div class="text-xs">恭賀團隊</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Annotation -->
            <section v-if="currentView === 'annotation'" class="animate-fade-in">
                <header class="flex justify-between items-center mb-6">
                    <div>
                        <div class="text-sm breadcrumbs p-0 mb-1">
                            <ul><li><a>問題解決</a></li><li>標註工具</li></ul>
                        </div>
                        <h1 class="text-2xl font-bold">影片標註工具</h1>
                    </div>
                </header>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Video Player -->
                    <div class="lg:col-span-2 card bg-base-100 shadow-sm border border-base-300">
                        <div class="card-body">
                            <div class="aspect-video bg-base-300 rounded-lg flex items-center justify-center">
                                <i data-lucide="video" class="w-12 h-12 opacity-40"></i>
                            </div>
                            <div class="flex gap-2 mt-4">
                                <button class="btn btn-sm"><i data-lucide="skip-back" class="w-4 h-4"></i></button>
                                <button class="btn btn-sm"><i data-lucide="play" class="w-4 h-4"></i></button>
                                <button class="btn btn-sm"><i data-lucide="skip-forward" class="w-4 h-4"></i></button>
                                <input type="range" min="0" max="100" value="0" class="range range-xs flex-1 mt-2">
                            </div>
                        </div>
                    </div>

                    <!-- Annotation Panel -->
                    <div class="card bg-base-100 shadow-sm border border-base-300">
                        <div class="card-body">
                            <h2 class="card-title text-sm font-bold">標註面板</h2>
                            <div class="form-control mb-4">
                                <label class="label"><span class="label-text">標註類型</span></label>
                                <select class="select select-bordered select-sm">
                                    <option>動作開始</option>
                                    <option>動作結束</option>
                                    <option>異常事件</option>
                                    <option>品質問題</option>
                                </select>
                            </div>
                            <div class="form-control mb-4">
                                <label class="label"><span class="label-text">備註</span></label>
                                <textarea class="textarea textarea-bordered" rows="3" placeholder="輸入標註說明..."></textarea>
                            </div>
                            <button class="btn btn-primary btn-sm w-full">
                                <i data-lucide="bookmark" class="w-4 h-4"></i> 新增標註
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings -->
            <section v-if="currentView === 'settings'" class="animate-fade-in">
                <header class="flex justify-between items-center mb-6">
                    <div>
                        <div class="text-sm breadcrumbs p-0 mb-1">
                            <ul><li><a>系統</a></li><li>設定</li></ul>
                        </div>
                        <h1 class="text-2xl font-bold">系統設定</h1>
                    </div>
                </header>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- API Settings -->
                    <div class="card bg-base-100 shadow-sm border border-base-300">
                        <div class="card-body">
                            <h2 class="card-title text-sm font-bold">API 設定</h2>
                            <div class="form-control mb-4">
                                <label class="label"><span class="label-text">後端 API URL</span></label>
                                <input type="text" class="input input-bordered" v-model="settings.apiUrl" placeholder="https://smai-mcp-center.onrender.com">
                            </div>
                            <div class="form-control mb-4">
                                <label class="label"><span class="label-text">API Key</span></label>
                                <input type="password" class="input input-bordered" v-model="settings.apiKey" placeholder="輸入 API Key">
                            </div>
                            <button class="btn btn-primary btn-sm" @click="saveSettings">儲存設定</button>
                        </div>
                    </div>

                    <!-- YOLO Settings -->
                    <div class="card bg-base-100 shadow-sm border border-base-300">
                        <div class="card-body">
                            <h2 class="card-title text-sm font-bold">YOLO 設定</h2>
                            <div class="form-control mb-4">
                                <label class="label"><span class="label-text">信心度閾值</span></label>
                                <input type="range" min="0" max="100" v-model="settings.confidenceThreshold" class="range range-primary">
                                <div class="text-xs text-right opacity-60">{{ settings.confidenceThreshold }}%</div>
                            </div>
                            <div class="form-control mb-4">
                                <label class="label cursor-pointer">
                                    <span class="label-text">顯示偵測框</span>
                                    <input type="checkbox" class="toggle toggle-primary" v-model="settings.showBoundingBox">
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- System Status -->
                    <div class="card bg-base-100 shadow-sm border border-base-300 lg:col-span-2">
                        <div class="card-body">
                            <h2 class="card-title text-sm font-bold">系統狀態</h2>
                            <div class="grid grid-cols-4 gap-4 mt-4">
                                <div class="stat bg-base-200 rounded-lg">
                                    <div class="stat-title">後端連線</div>
                                    <div class="stat-value text-success text-lg">正常</div>
                                </div>
                                <div class="stat bg-base-200 rounded-lg">
                                    <div class="stat-title">YOLO 模型</div>
                                    <div class="stat-value text-success text-lg">就緒</div>
                                </div>
                                <div class="stat bg-base-200 rounded-lg">
                                    <div class="stat-title">資料庫</div>
                                    <div class="stat-value text-success text-lg">連線</div>
                                </div>
                                <div class="stat bg-base-200 rounded-lg">
                                    <div class="stat-title">版本</div>
                                    <div class="stat-value text-lg">v1.0.0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </main>

        <!-- New Report Modal -->
        <dialog id="new_report_modal" class="modal" :class="{ 'modal-open': showNewReportModal }">
            <div class="modal-box">
                <h3 class="font-bold text-lg mb-4">新增 8D 報告</h3>
                <div class="space-y-4">
                    <div class="form-control">
                        <label class="label"><span class="label-text">問題標題</span></label>
                        <input type="text" class="input input-bordered" v-model="newReport.title" placeholder="簡述問題">
                    </div>
                    <div class="form-control">
                        <label class="label"><span class="label-text">關聯影片</span></label>
                        <select class="select select-bordered" v-model="newReport.videoId">
                            <option value="">-- 選擇影片 --</option>
                            <option v-for="v in videos" :key="v.id" :value="v.id">{{ v.name }}</option>
                        </select>
                    </div>
                    <div class="form-control">
                        <label class="label"><span class="label-text">問題描述</span></label>
                        <textarea class="textarea textarea-bordered" rows="3" v-model="newReport.description" placeholder="詳細描述問題"></textarea>
                    </div>
                </div>
                <div class="modal-action">
                    <button class="btn" @click="showNewReportModal = false">取消</button>
                    <button class="btn btn-primary" @click="createReport">建立報告</button>
                </div>
            </div>
            <form method="dialog" class="modal-backdrop" @click="showNewReportModal = false">
                <button>close</button>
            </form>
        </dialog>

    </div>

    <script>
        const { createApp, ref, reactive, onMounted, nextTick, watch } = Vue;

        // API 基礎路徑
        const API_BASE = 'https://smai-mcp-center.onrender.com/api/aoi';

        createApp({
            setup() {
                const currentView = ref('dashboard');
                const dragOver = ref(false);
                const showNewReportModal = ref(false);

                // Stats
                const stats = reactive({
                    videoCount: 0,
                    analyzedCount: 0,
                    reportCount: 0,
                    avgCycleTime: 0,
                    cycleImprovement: 0
                });

                // Data
                const videos = ref([]);
                const reports = ref([]);
                const recentActivities = ref([]);
                const analysisResults = ref([]);
                const selectedAnalysisVideoId = ref('');
                const selectedAnalysisVideo = ref(null);

                // Settings
                const settings = reactive({
                    apiUrl: 'https://smai-mcp-center.onrender.com',
                    apiKey: '',
                    confidenceThreshold: 50,
                    showBoundingBox: true
                });

                // New Report Form
                const newReport = reactive({
                    title: '',
                    videoId: '',
                    description: ''
                });

                // Methods
                const updateIcons = () => {
                    nextTick(() => { lucide.createIcons(); });
                };

                const refreshDashboard = async () => {
                    try {
                        const response = await fetch(`${API_BASE}/stats`);
                        if (response.ok) {
                            const data = await response.json();
                            Object.assign(stats, data.data || data);
                        }
                    } catch (e) {
                        console.log('Using mock data');
                        // Mock data for demo
                        stats.videoCount = 5;
                        stats.analyzedCount = 3;
                        stats.reportCount = 2;
                        stats.avgCycleTime = 38.5;
                        stats.cycleImprovement = 15;
                    }
                };

                const loadVideos = async () => {
                    try {
                        const response = await fetch(`${API_BASE}/videos`);
                        if (response.ok) {
                            const data = await response.json();
                            videos.value = data.data || [];
                        }
                    } catch (e) {
                        console.log('Using mock video data');
                        videos.value = [
                            { id: '1', name: 'assembly_line_01.mp4', duration: '00:45', size: '12.5 MB', status: '已分析', statusBadge: 'badge-success' },
                            { id: '2', name: 'packaging_process.mp4', duration: '01:20', size: '28.3 MB', status: '待分析', statusBadge: 'badge-warning' },
                            { id: '3', name: 'quality_check.mp4', duration: '00:32', size: '8.7 MB', status: '分析中', statusBadge: 'badge-info' }
                        ];
                    }
                };

                const loadReports = async () => {
                    try {
                        const response = await fetch(`${API_BASE}/reports`);
                        if (response.ok) {
                            const data = await response.json();
                            reports.value = data.data || [];
                        }
                    } catch (e) {
                        console.log('Using mock report data');
                        reports.value = [
                            { id: '1', reportNo: '8D-2024-001', title: '組裝線週期時間過長', createdAt: '2024-12-20', progress: 75, currentStep: 6, status: '進行中', statusBadge: 'badge-info' },
                            { id: '2', reportNo: '8D-2024-002', title: '包裝不良率偏高', createdAt: '2024-12-18', progress: 100, currentStep: 8, status: '已完成', statusBadge: 'badge-success' }
                        ];
                    }
                };

                const loadRecentActivities = () => {
                    recentActivities.value = [
                        { id: 1, time: '10 分鐘前', type: '影片上傳', typeBadge: 'badge-primary', content: 'assembly_line_01.mp4', status: '成功', statusBadge: 'badge-success' },
                        { id: 2, time: '30 分鐘前', type: 'AOI 分析', typeBadge: 'badge-secondary', content: 'packaging_process.mp4', status: '完成', statusBadge: 'badge-success' },
                        { id: 3, time: '1 小時前', type: '8D 報告', typeBadge: 'badge-accent', content: '8D-2024-001 更新至 D6', status: '進行中', statusBadge: 'badge-info' }
                    ];
                };

                const handleFileSelect = (e) => {
                    const files = e.target.files;
                    uploadFiles(files);
                };

                const handleDrop = (e) => {
                    dragOver.value = false;
                    const files = e.dataTransfer.files;
                    uploadFiles(files);
                };

                const uploadFiles = async (files) => {
                    for (const file of files) {
                        console.log('Uploading:', file.name);
                        // TODO: Implement actual upload
                        videos.value.push({
                            id: Date.now().toString(),
                            name: file.name,
                            duration: '--:--',
                            size: `${(file.size / 1024 / 1024).toFixed(1)} MB`,
                            status: '待分析',
                            statusBadge: 'badge-warning'
                        });
                    }
                    stats.videoCount = videos.value.length;
                    updateIcons();
                };

                const viewVideo = (video) => {
                    console.log('View video:', video.name);
                };

                const analyzeVideo = async (video) => {
                    video.status = '分析中';
                    video.statusBadge = 'badge-info';
                    // TODO: Call AOI analysis API
                    setTimeout(() => {
                        video.status = '已分析';
                        video.statusBadge = 'badge-success';
                        stats.analyzedCount++;
                    }, 3000);
                };

                const selectAnalysisVideo = () => {
                    selectedAnalysisVideo.value = videos.value.find(v => v.id === selectedAnalysisVideoId.value);
                };

                const createReport = async () => {
                    const report = {
                        id: Date.now().toString(),
                        reportNo: `8D-${new Date().getFullYear()}-${String(reports.value.length + 1).padStart(3, '0')}`,
                        title: newReport.title,
                        createdAt: new Date().toISOString().split('T')[0],
                        progress: 12.5,
                        currentStep: 1,
                        status: '進行中',
                        statusBadge: 'badge-info'
                    };
                    reports.value.unshift(report);
                    stats.reportCount = reports.value.length;
                    showNewReportModal.value = false;
                    newReport.title = '';
                    newReport.videoId = '';
                    newReport.description = '';
                };

                const editReport = (report) => {
                    console.log('Edit report:', report.reportNo);
                };

                const saveSettings = () => {
                    localStorage.setItem('pv_settings', JSON.stringify(settings));
                    alert('設定已儲存');
                };

                const loadSettings = () => {
                    const saved = localStorage.getItem('pv_settings');
                    if (saved) {
                        Object.assign(settings, JSON.parse(saved));
                    }
                };

                // Watch view changes
                watch(currentView, () => {
                    updateIcons();
                });

                // Initialize
                onMounted(() => {
                    updateIcons();
                    loadSettings();
                    refreshDashboard();
                    loadVideos();
                    loadReports();
                    loadRecentActivities();
                });

                return {
                    currentView,
                    dragOver,
                    showNewReportModal,
                    stats,
                    videos,
                    reports,
                    recentActivities,
                    analysisResults,
                    selectedAnalysisVideoId,
                    selectedAnalysisVideo,
                    settings,
                    newReport,
                    refreshDashboard,
                    handleFileSelect,
                    handleDrop,
                    viewVideo,
                    analyzeVideo,
                    selectAnalysisVideo,
                    createReport,
                    editReport,
                    saveSettings
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
